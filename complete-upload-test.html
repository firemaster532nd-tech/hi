<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™„ì „ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #ff6b9d; }
        h2 { color: #333; border-bottom: 2px solid #ff6b9d; padding-bottom: 10px; }
        button {
            background: #ff6b9d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 15px;
        }
        button:hover { opacity: 0.9; }
        button.secondary { background: #666; }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
        }
        .log {
            background: #f9f9f9;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #ddd;
        }
        .preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .preview img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #ddd;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; }
        .warning { color: #ffc107; }
        label { font-weight: bold; margin-top: 10px; display: block; }
        .required { color: red; }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-ok { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ì™„ì „ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>

    <div class="test-section">
        <h2>1ï¸âƒ£ ì„œë²„ ìƒíƒœ í™•ì¸</h2>
        <button onclick="checkServer()">ğŸ” ì„œë²„ í™•ì¸</button>
        <button onclick="checkPhotos()" class="secondary">ğŸ“‹ ì‚¬ì§„ ëª©ë¡ í™•ì¸</button>
        <div id="serverLog" class="log">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ ì™„ì „í•œ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        
        <label>ğŸ–¼ï¸ ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ <span class="required">*</span></label>
        <input type="file" id="testFile" accept="image/*" onchange="previewFile()">
        <div id="filePreview" class="preview"></div>

        <label>ğŸ“ ì œëª© <span class="required">*</span></label>
        <input type="text" id="testTitle" value="í…ŒìŠ¤íŠ¸ ì‚¬ì§„" onkeyup="checkForm()">

        <label>ğŸ“… ë‚ ì§œ <span class="required">*</span></label>
        <input type="date" id="testDate" onchange="checkForm()">

        <label>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ <span class="required">*</span></label>
        <select id="testCategory" onchange="checkForm()">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="daily">ì¼ìƒ</option>
            <option value="grooming">ë¯¸ìš©ì‚¬ì§„</option>
            <option value="travel">ì—¬í–‰</option>
            <option value="friends">ì¹œêµ¬ë“¤</option>
            <option value="special">íŠ¹ë³„í•œ ë‚ </option>
        </select>

        <label>ğŸ’¬ ì„¤ëª… (ì„ íƒ)</label>
        <textarea id="testDescription" rows="3">í…ŒìŠ¤íŠ¸ ì—…ë¡œë“œ</textarea>

        <br><br>
        <div id="formStatus"></div>
        <button onclick="testUpload()">ğŸ“¤ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <button onclick="resetForm()" class="secondary">ğŸ”„ í¼ ì´ˆê¸°í™”</button>
        
        <div id="uploadLog" class="log">ì—…ë¡œë“œ ë¡œê·¸ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ í™•ì¸</h2>
        <button onclick="window.open('kimchi-gallery.html', '_blank')">ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬ ì—´ê¸°</button>
        <p style="color: #666; margin-top: 10px;">
            â„¹ï¸ ì—…ë¡œë“œ í›„ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¥¼ ì—´ì–´ ì‚¬ì§„ì²© ì„¹ì…˜ì—ì„œ ì¹´ë“œ1ì— ì‚¬ì§„ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
        </p>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('testDate').value = today;
            document.getElementById('testCategory').value = 'daily';
            checkServer();
            checkForm();
        });

        function log(id, msg, type = 'info') {
            const el = document.getElementById(id);
            const time = new Date().toLocaleTimeString();
            let icon = 'ğŸ“';
            if (type === 'success') icon = 'âœ…';
            if (type === 'error') icon = 'âŒ';
            if (type === 'warning') icon = 'âš ï¸';
            if (type === 'info') icon = 'â„¹ï¸';
            
            el.innerHTML += `<div class="${type}">${icon} [${time}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        function clearLog(id) {
            document.getElementById(id).innerHTML = '';
        }

        async function checkServer() {
            clearLog('serverLog');
            log('serverLog', 'ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/photos`);
                const data = await response.json();
                
                log('serverLog', `ì„œë²„ ì‘ë‹µ: ${response.status}`, 'success');
                log('serverLog', `í˜„ì¬ ì‚¬ì§„ ê°œìˆ˜: ${data.data.length}ê°œ`, 'info');
                
                if (data.success) {
                    log('serverLog', 'âœ… ì„œë²„ê°€ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!', 'success');
                }
            } catch (error) {
                log('serverLog', `ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function checkPhotos() {
            clearLog('serverLog');
            log('serverLog', 'ì‚¬ì§„ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/photos`);
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    log('serverLog', `ì´ ${data.data.length}ê°œì˜ ì‚¬ì§„ì´ ìˆìŠµë‹ˆë‹¤:`, 'success');
                    data.data.forEach((photo, i) => {
                        log('serverLog', `  ${i+1}. ${photo.title} (${photo.category}) - ${photo.date}`, 'info');
                    });
                } else {
                    log('serverLog', 'ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                log('serverLog', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function previewFile() {
            const file = document.getElementById('testFile').files[0];
            const preview = document.getElementById('filePreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
                checkForm();
            }
        }

        function checkForm() {
            const title = document.getElementById('testTitle').value.trim();
            const date = document.getElementById('testDate').value;
            const category = document.getElementById('testCategory').value;
            const file = document.getElementById('testFile').files[0];
            
            const status = document.getElementById('formStatus');
            let html = '<div style="margin: 10px 0;">';
            
            html += title ? '<span class="status-badge status-ok">âœ“ ì œëª©</span>' : '<span class="status-badge status-error">âœ— ì œëª©</span>';
            html += date ? '<span class="status-badge status-ok">âœ“ ë‚ ì§œ</span>' : '<span class="status-badge status-error">âœ— ë‚ ì§œ</span>';
            html += (category && category !== '') ? '<span class="status-badge status-ok">âœ“ ì¹´í…Œê³ ë¦¬</span>' : '<span class="status-badge status-error">âœ— ì¹´í…Œê³ ë¦¬</span>';
            html += file ? '<span class="status-badge status-ok">âœ“ íŒŒì¼</span>' : '<span class="status-badge status-error">âœ— íŒŒì¼</span>';
            
            html += '</div>';
            
            const allValid = title && date && category && category !== '' && file;
            if (allValid) {
                html += '<div class="success">âœ… ëª¨ë“  í•„ìˆ˜ í•­ëª©ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
            } else {
                html += '<div class="error">âŒ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
            }
            
            status.innerHTML = html;
            return allValid;
        }

        async function testUpload() {
            clearLog('uploadLog');
            
            if (!checkForm()) {
                log('uploadLog', 'í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            const file = document.getElementById('testFile').files[0];
            const title = document.getElementById('testTitle').value.trim();
            const date = document.getElementById('testDate').value;
            const category = document.getElementById('testCategory').value;
            const description = document.getElementById('testDescription').value;
            
            log('uploadLog', '=== ì—…ë¡œë“œ ì‹œì‘ ===', 'info');
            log('uploadLog', `íŒŒì¼: ${file.name} (${file.type}, ${(file.size/1024).toFixed(2)}KB)`, 'info');
            log('uploadLog', `ì œëª©: "${title}"`, 'info');
            log('uploadLog', `ë‚ ì§œ: "${date}"`, 'info');
            log('uploadLog', `ì¹´í…Œê³ ë¦¬: "${category}"`, 'info');
            log('uploadLog', `ì„¤ëª…: "${description}"`, 'info');
            
            log('uploadLog', 'íŒŒì¼ì„ Base64ë¡œ ë³€í™˜ ì¤‘...', 'info');
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                const dataUrl = e.target.result;
                log('uploadLog', `Base64 ë³€í™˜ ì™„ë£Œ (ê¸¸ì´: ${dataUrl.length})`, 'success');
                
                const photoData = {
                    title: title,
                    date: date,
                    category: category,
                    description: description,
                    dataUrl: dataUrl
                };
                
                log('uploadLog', 'API ìš”ì²­ ì „ì†¡ ì¤‘...', 'info');
                log('uploadLog', `URL: ${API_BASE}/api/photos`, 'info');
                
                try {
                    const response = await fetch(`${API_BASE}/api/photos`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(photoData)
                    });
                    
                    log('uploadLog', `ì‘ë‹µ ì½”ë“œ: ${response.status}`, response.ok ? 'success' : 'error');
                    
                    const result = await response.json();
                    log('uploadLog', `ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result, null, 2)}`, 'info');
                    
                    if (result.success) {
                        log('uploadLog', 'âœ…âœ…âœ… ì—…ë¡œë“œ ì„±ê³µ! âœ…âœ…âœ…', 'success');
                        log('uploadLog', `ì‚¬ì§„ ID: ${result.data.id}`, 'success');
                        log('uploadLog', `ì œëª©: ${result.data.title}`, 'success');
                        log('uploadLog', `ì¹´í…Œê³ ë¦¬: ${result.data.category}`, 'success');
                        log('uploadLog', '', 'info');
                        log('uploadLog', 'ğŸ’¡ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì„¸ìš”!', 'success');
                        
                        // 3ì´ˆ í›„ ê°¤ëŸ¬ë¦¬ë¡œ ì´ë™ ì œì•ˆ
                        setTimeout(() => {
                            if (confirm('ì—…ë¡œë“œ ì„±ê³µ! ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                window.open('kimchi-gallery.html', '_blank');
                            }
                        }, 2000);
                    } else {
                        log('uploadLog', `ì—…ë¡œë“œ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                    }
                } catch (error) {
                    log('uploadLog', `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                    log('uploadLog', `ìƒì„¸: ${error.stack}`, 'error');
                }
            };
            
            reader.onerror = (error) => {
                log('uploadLog', `íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${error}`, 'error');
            };
            
            reader.readAsDataURL(file);
        }

        function resetForm() {
            document.getElementById('testFile').value = '';
            document.getElementById('testTitle').value = 'í…ŒìŠ¤íŠ¸ ì‚¬ì§„';
            document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('testCategory').value = 'daily';
            document.getElementById('testDescription').value = 'í…ŒìŠ¤íŠ¸ ì—…ë¡œë“œ';
            document.getElementById('filePreview').innerHTML = '';
            checkForm();
            clearLog('uploadLog');
        }
    </script>
</body>
</html>
