<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë²„ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸ - ê¹€ì¹˜ ê°¤ëŸ¬ë¦¬</title>
    <link rel="stylesheet" href="css/kimchi-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .test-section {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .test-button:hover {
            opacity: 0.9;
        }
        .status-box {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ì„œë²„ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>1. ì„œë²„ ìƒíƒœ í™•ì¸</h2>
            <button class="test-button" onclick="checkServerStatus()">
                <i class="fas fa-server"></i> ì„œë²„ ìƒíƒœ í™•ì¸
            </button>
            <div id="serverStatus" class="status-box">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-section">
            <h2>2. ë°ì´í„° ì¡°íšŒ</h2>
            <button class="test-button" onclick="loadPhotos()">
                <i class="fas fa-images"></i> ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
            <button class="test-button" onclick="loadVideos()">
                <i class="fas fa-video"></i> ì˜ìƒ ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
            <div id="dataStatus" class="status-box">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-section">
            <h2>3. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</h2>
            <button class="test-button" onclick="addTestPhoto()">
                <i class="fas fa-plus"></i> í…ŒìŠ¤íŠ¸ ì‚¬ì§„ ì¶”ê°€
            </button>
            <button class="test-button" onclick="addTestVideo()">
                <i class="fas fa-plus"></i> í…ŒìŠ¤íŠ¸ ì˜ìƒ ì¶”ê°€
            </button>
            <div id="addStatus" class="status-box">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-section">
            <h2>4. localStorage ì´ˆê¸°í™”</h2>
            <button class="test-button" onclick="clearLocalStorage()">
                <i class="fas fa-trash"></i> localStorage ì´ˆê¸°í™”
            </button>
            <div id="clearStatus" class="status-box">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-section">
            <h2>5. ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™</h2>
            <a href="kimchi-gallery.html" class="test-button" style="display: inline-block; text-decoration: none;">
                <i class="fas fa-arrow-right"></i> ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ ì—´ê¸°
            </a>
            <p style="margin-top: 1rem; color: #666;">
                â„¹ï¸ ì„œë²„ ê¸°ë°˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì¼í•œ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // ë¡œê·¸ ì¶œë ¥ í—¬í¼
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        // 1. ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            clearLog('serverStatus');
            log('serverStatus', 'ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/photos`);
                if (response.ok) {
                    log('serverStatus', 'âœ… ì„œë²„ê°€ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!', 'success');
                    log('serverStatus', `ì„œë²„ URL: ${API_BASE}`, 'info');
                } else {
                    log('serverStatus', `âŒ ì„œë²„ ì˜¤ë¥˜: ${response.status}`, 'error');
                }
            } catch (error) {
                log('serverStatus', `âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // 2. ë°ì´í„° ì¡°íšŒ
        async function loadPhotos() {
            clearLog('dataStatus');
            log('dataStatus', 'ì‚¬ì§„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/photos`);
                const result = await response.json();
                
                if (result.success) {
                    log('dataStatus', `âœ… ì´ ${result.data.length}ê°œì˜ ì‚¬ì§„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                    if (result.data.length > 0) {
                        log('dataStatus', '\nì‚¬ì§„ ëª©ë¡:', 'info');
                        result.data.forEach((photo, index) => {
                            log('dataStatus', `  ${index + 1}. ${photo.title} (${photo.category}) - ${photo.date}`, 'info');
                        });
                    } else {
                        log('dataStatus', 'â„¹ï¸ ì•„ì§ ì—…ë¡œë“œëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    }
                } else {
                    log('dataStatus', `âŒ ì˜¤ë¥˜: ${result.error}`, 'error');
                }
            } catch (error) {
                log('dataStatus', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function loadVideos() {
            clearLog('dataStatus');
            log('dataStatus', 'ì˜ìƒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/videos`);
                const result = await response.json();
                
                if (result.success) {
                    log('dataStatus', `âœ… ì´ ${result.data.length}ê°œì˜ ì˜ìƒì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                    if (result.data.length > 0) {
                        log('dataStatus', '\nì˜ìƒ ëª©ë¡:', 'info');
                        result.data.forEach((video, index) => {
                            log('dataStatus', `  ${index + 1}. ${video.title} - ${video.date}`, 'info');
                        });
                    } else {
                        log('dataStatus', 'â„¹ï¸ ì•„ì§ ì—…ë¡œë“œëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    }
                } else {
                    log('dataStatus', `âŒ ì˜¤ë¥˜: ${result.error}`, 'error');
                }
            } catch (error) {
                log('dataStatus', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 3. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
        async function addTestPhoto() {
            clearLog('addStatus');
            log('addStatus', 'í…ŒìŠ¤íŠ¸ ì‚¬ì§„ ì¶”ê°€ ì¤‘...', 'info');
            
            // 1x1 íˆ¬ëª… PNG (Base64)
            const testImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
            
            const testData = {
                title: `í…ŒìŠ¤íŠ¸ ì‚¬ì§„ ${new Date().toLocaleTimeString()}`,
                date: new Date().toISOString().split('T')[0],
                category: 'daily',
                description: 'ì„œë²„ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸ìš© ì‚¬ì§„ì…ë‹ˆë‹¤.',
                dataUrl: testImage
            };

            try {
                const response = await fetch(`${API_BASE}/api/photos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log('addStatus', 'âœ… í…ŒìŠ¤íŠ¸ ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    log('addStatus', `ID: ${result.data.id}`, 'info');
                    log('addStatus', `ì œëª©: ${result.data.title}`, 'info');
                    log('addStatus', `ì¹´í…Œê³ ë¦¬: ${result.data.category}`, 'info');
                    log('addStatus', '\nğŸ’¡ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”!', 'info');
                } else {
                    log('addStatus', `âŒ ì˜¤ë¥˜: ${result.error}`, 'error');
                }
            } catch (error) {
                log('addStatus', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function addTestVideo() {
            clearLog('addStatus');
            log('addStatus', 'í…ŒìŠ¤íŠ¸ ì˜ìƒ ì¶”ê°€ ì¤‘...', 'info');
            
            // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤ ë°ì´í„°
            const testVideo = 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAAhtZGF0AAAA';
            
            const testData = {
                title: `í…ŒìŠ¤íŠ¸ ì˜ìƒ ${new Date().toLocaleTimeString()}`,
                date: new Date().toISOString().split('T')[0],
                description: 'ì„œë²„ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸ìš© ì˜ìƒì…ë‹ˆë‹¤.',
                dataUrl: testVideo
            };

            try {
                const response = await fetch(`${API_BASE}/api/videos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log('addStatus', 'âœ… í…ŒìŠ¤íŠ¸ ì˜ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    log('addStatus', `ID: ${result.data.id}`, 'info');
                    log('addStatus', `ì œëª©: ${result.data.title}`, 'info');
                    log('addStatus', '\nğŸ’¡ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”!', 'info');
                } else {
                    log('addStatus', `âŒ ì˜¤ë¥˜: ${result.error}`, 'error');
                }
            } catch (error) {
                log('addStatus', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 4. localStorage ì´ˆê¸°í™”
        function clearLocalStorage() {
            clearLog('clearStatus');
            log('clearStatus', 'localStorage ì´ˆê¸°í™” ì¤‘...', 'info');
            
            const keys = Object.keys(localStorage);
            const kimchiKeys = keys.filter(key => key.startsWith('kimchi'));
            
            if (kimchiKeys.length === 0) {
                log('clearStatus', 'â„¹ï¸ ì´ˆê¸°í™”í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
            } else {
                kimchiKeys.forEach(key => {
                    localStorage.removeItem(key);
                    log('clearStatus', `ì‚­ì œë¨: ${key}`, 'info');
                });
                log('clearStatus', `\nâœ… ì´ ${kimchiKeys.length}ê°œì˜ localStorage í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
            
            log('clearStatus', '\nğŸ’¡ ì´ì œ ì„œë²„ ê¸°ë°˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. localStorageëŠ” ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('DOMContentLoaded', () => {
            checkServerStatus();
        });
    </script>
</body>
</html>
